tinymce.PluginManager.add("mathjax",function(e,t){const n=e.getParam("mathjax")||{},a=n.className||"math-tex",s=a+"-original",o=n.lib,r=[n.configUrl||`${t}/config.js`];n.className&&(r[0]+=`?class=${n.className}`),o&&r.push(o);const c=()=>new Promise(e=>{if(window.MathJax?.typesetPromise)return void e();const t=()=>{window.MathJax?.typesetPromise?e():setTimeout(t,100)};t()}),i=()=>{const t=e.getDoc().defaultView.MathJax;t?.typesetPromise&&t.typesetPromise()},l=t=>{if(2===t.childNodes.length)return;t.setAttribute("contenteditable","false"),t.style.cursor="default";const n=t.getAttribute("data-latex")||t.innerHTML;t.setAttribute("data-latex",n),t.innerHTML="";const a=e.dom.create("span",{class:s,innerHTML:n});t.appendChild(a);const o=e.dom.create("span",{class:"dummy",innerHTML:"dummy",hidden:"hidden"});t.appendChild(o)},d=e=>{const t=e.getAttribute("data-latex");e.removeAttribute("contenteditable"),e.removeAttribute("style"),e.removeAttribute("data-latex"),e.innerHTML=t};e.on("init",()=>{(()=>{const t=e.getDoc().getElementsByTagName("script"),n=e.getDoc().getElementsByTagName("head")[0];r.forEach(a=>{if(!Array.from(t).some(e=>e.src===a||e.src.endsWith(a.split("/").pop()))){const t=e.dom.create("script",{type:"text/javascript",src:a});n.appendChild(t)}})})(),c().then(i)}),e.on("GetContent",t=>{const n=e.dom.create("div");n.innerHTML=t.content,n.querySelectorAll(`.${a}`).forEach(d),t.content=n.innerHTML}),e.on("BeforeSetContent",t=>{const n=e.dom.create("div");var s;n.innerHTML=(s=t.content,[/\$\$([^$]+)\$\$/g].forEach(e=>{s=s.replace(e,"<span class='math-tex' data-latex='\\[$1\\]' contenteditable='false' style='cursor: pointer;'><span class='math-tex-original'>\\[$1\\]</span><span class='dummy' hidden='hidden'>dummy</span></span>")}),[/\$([^$]+)\$/g].forEach(e=>{s=s.replace(e,"<span class='math-tex' data-latex='\\($1\\)' contenteditable='false' style='cursor: pointer;'><span class='math-tex-original'>\\($1\\)</span><span class='dummy' hidden='hidden'>dummy</span></span>")}),s),n.querySelectorAll(`.${a}`).forEach(l),t.content=n.innerHTML}),e.on("SetContent",()=>{c().then(i)}),e.on("Change",()=>{const t=e.dom.getRoot().querySelectorAll(`.${a}`);0!==t.length&&(t.forEach(l),c().then(i))})});